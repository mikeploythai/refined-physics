Code "Better Spin Boost Physics" by "mploythai"
//
  #include "ReflectionHelpers" noemit

  #lib "Sonic"
  #lib "SonicParameters"
  #lib "MathHelpers"

  static float chargeCount = 1.0f;
//
{
  // Makes the spin boost act like a normal roll when it's not charged
  var dashVelocity = Sonic.Kinematics.GetHorizontalMagnitude();

  if (Sonic.IsGrounded() && Sonic.State.GetCurrentStateID() == Sonic.StateID.StateSpinBoostCharge) {
    // Shout out to Weezley. I referenced their Legacy Spin Dash mod to figure out how to implement charging!
    if (Sonic.Input.IsPressed(Sonic.PlayerActionType.PlayerSonicboom))
      chargeCount += 1;
    
    dashVelocity = MathHelpers.Clamp(13.0f * chargeCount, 13.0f, 65.0f);
  } else {
    dashVelocity = Sonic.Kinematics.GetHorizontalMagnitude();
    chargeCount = 1;
  }

  var SonicParams = Reflection.GetDataInfo<SonicParameters.Root>("player_common");

  if (SonicParams.pData == null) return;

  RFL_SET_PARAM(SonicParams, forwardView.spinBoost.speedBoost.initialSpeed, dashVelocity);
}